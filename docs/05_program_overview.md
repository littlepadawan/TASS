# Program Overview

This file contains a highlevel description of how the program works. For more information about how the program was developed, refer to the thesis report [TBI once it have been published]

## Program Flow

The following steps outline the overall flow of the program:
1. The main module initialises the program.
2. The configuration file is read.
3. A directory is created to store the generated spectra. 
4. Stellar parameters are either read from a file or generated by the program.
5. Turbospectrum and the interpolator are compiled. 
6. For each set of stellar parameters, a spectrum is generated:
    1. Determine if interpolation is needed. Interpolation is required if there is no matching model atmosphere for the given stellar parameters.
        - If a matching model is found, proceed to step ii
        - If no matching model is found:
            - Find 8 bracketing models according to the pattern specified by the interpolator.
                - If either of the 8 required models is not found, a spectrum for this set of stellar parameters is not generated. 
                - If more than one matching model is found for either of these 8 required models, a spectrum for this set of stellar parameters is not generated.
    2. Generate and run the interpolation script.
    3. Assign the result from the interpolation as the model atmosphere to use when invoking Turbospectrum
    4. Generate the babsma script.
    5. Run the babsma script
    6. Generate bsyn script.
    7. Run the bsyn scrict.
7. Temporary files used during the run are removed (this can be easily toggled in the source code if you want to be able to access log files from running the scripts).

## Interpolation
An overview of the logic of the function that gets the bracketing models used for interpolation:

![Get bracketing models](/docs/get_bracketing_models.png "Flowchart of the function that gets bracketing models for interpolation")

## Running the Tests

This command have been used to run the tests and measure code and branch coverage: </br>
`coverage run --rcfile=.coveragerc --branch -m unittest discover -s tests`

This requires having the coverage library installed. The following command should run the tests without coverage: </br>
`python3 -m unittest discover`


